# Claude Code Conversation Context

## Project Overview
**Location:** `/Users/apple/RustroverProjects/TurbinePB_Q425_didier-ds`
**Type:** Solana NFT Marketplace with Discord Bot
**Main Program:** `nft-marketplace-telegram/programs/nft_marketplace`
**Bot:** `nft-marketplace-telegram/bot`

## Last Session Summary (2025-11-21)

### Smart Contract - COMPLETE
**Program ID:** `67AAvxuwtST6foKb3141DAy4eUGnUFVZYERKEBytu5sc`
**Deployed to:** Devnet

#### Instructions Implemented:
1. `list_nft` - List NFT for sale (locks in escrow)
2. `cancel_listing` - Cancel and return NFT
3. `buy_nft` - Purchase NFT (SOL → seller, NFT → buyer)

### Discord Bot - IN PROGRESS
**Location:** `nft-marketplace-telegram/bot`

#### Working Commands:
- `/ping` - Test bot
- `/wallet` - Create/import wallet (with buttons for new or import)
- `/list <mint> <price>` - List NFT for sale (calls smart contract)
- `/browse` - View all listings from blockchain (with Buy buttons)

#### Working Features:
- Wallet creation/import with modal
- Listing NFTs (calls smart contract)
- Browsing listings (fetches from blockchain via `program.account.listing.all()`)
- Buy button handler (calls `buyNft`)
- NFT metadata fetching (ready for images/names)

### Current State
- Bot is connected to **devnet**
- Program deployed to devnet
- User needs to mint an NFT with Metaplex metadata to test images

### Pending Tasks
- Mint NFT using `/Users/apple/RustroverProjects/TurbinePB_Q425_didier-ds/dogeatdog-nft/create-nft.js`
- Test full flow: list → browse (with images) → buy
- Add MongoDB for persistence
- Add more commands: `/my-listings`, `/cancel`, `/help`

## Project Structure

```
nft-marketplace-telegram/
├── programs/nft_marketplace/src/
│   ├── lib.rs
│   ├── error.rs
│   └── instructions/
│       ├── list_nft.rs
│       ├── cancel_listing.rs
│       └── buy_nft.rs
├── bot/
│   ├── src/
│   │   ├── index.ts           # Main entry, event handlers
│   │   ├── commands/
│   │   │   ├── wallet.ts      # /wallet command
│   │   │   ├── list.ts        # /list command
│   │   │   └── browse.ts      # /browse command
│   │   ├── services/
│   │   │   ├── solana.service.ts     # Wallet ops
│   │   │   ├── marketplace.service.ts # Smart contract calls
│   │   │   └── nft.service.ts        # NFT metadata fetching
│   │   ├── stores/
│   │   │   └── listings.ts    # In-memory store (unused now)
│   │   └── register-commands.ts
│   ├── .env                   # Discord token, RPC URL, Program ID
│   └── package.json
└── tests/
    ├── nft_marketplace.ts
    ├── cancel_listing.ts
    └── buy_nft.ts
```

## Key Files

### bot/.env
```
DISCORD_TOKEN=<your_token>
DISCORD_CLIENT_ID=1441167052516626533
DISCORD_GUILD_ID=<your_server>
SOLANA_RPC_URL=https://api.devnet.solana.com
NFT_MARKETPLACE_PROGRAM_ID=67AAvxuwtST6foKb3141DAy4eUGnUFVZYERKEBytu5sc
```

### Services

**marketplace.service.ts** - Core functions:
- `listNft()` - Call list_nft instruction
- `buyNft()` - Call buy_nft instruction
- `cancelListing()` - Call cancel_listing instruction
- `getAllListings()` - Fetch all listing accounts from blockchain
- `getListing()` - Fetch single listing

**nft.service.ts** - NFT metadata:
- `getNftMetadata()` - Fetch name, image, description from Metaplex

## To Continue

1. **Mint NFT with images:**
   ```bash
   cd /Users/apple/RustroverProjects/TurbinePB_Q425_didier-ds/dogeatdog-nft
   npm install
   node create-nft.js
   ```

2. **Fund bot wallet with devnet SOL:**
   - Use https://faucet.solana.com
   - Or `solana airdrop 2 <WALLET_ADDRESS> --url devnet`

3. **Test the flow:**
   - `/wallet` - Create wallet
   - `/list <NFT_MINT> <price>` - List the minted NFT
   - `/browse` - See listing with image
   - Click Buy button - Purchase

4. **Next features to build:**
   - `/my-listings` - Show user's listings
   - `/cancel` - Cancel a listing
   - MongoDB integration
   - DM notifications

## Git Status
- Branch: `main`
- Uncommitted changes in bot directory

## Notes
- Using discord.js v14
- Anchor framework for smart contracts
- Bot uses buttons and modals for UX
- Listings fetched directly from blockchain (source of truth)
- NFT metadata parsed from Metaplex accounts
